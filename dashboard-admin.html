<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Admin - Imunisasi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style/dashboard-admin.css">
  <style>
    #sidebarOverlay { z-index: 1000 !important; display: none !important; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script/firebase-ini.js"></script>
</head>
<body>
  <button class="mobile-menu-btn" onclick="toggleSidebar()" title="Toggle Menu">
    <i class="fas fa-bars"></i>
  </button>
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

  <nav class="sidebar" id="sidebar">
    <h4 class="mb-4">
      <i class="fas fa-shield-virus me-2"></i>
      Admin Imunisasi
    </h4>
    <a onclick="showDashboard(); setPageTitle('Dashboard'); closeSidebar()">
      <i class="fas fa-home"></i>
      <span>Dashboard</span>
    </a>
    <div class="dropdown">
      <a class="dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-clipboard-list"></i>
        <span>Data Imunisasi</span>
      </a>
      <ul class="dropdown-menu dropdown-menu-dark bg-gradient">
        <li><a class="dropdown-item text-white" onclick="loadContent('data-anak.html'); setPageTitle('Data Anak'); closeSidebar()">
          <i class="fas fa-baby"></i> Data Anak
        </a></li>
        <li><a class="dropdown-item text-white" onclick="loadContent('input-perkembangan-anak.html'); setPageTitle('Input Perkembangan Anak'); closeSidebar()">
          <i class="fas fa-edit"></i> Input Perkembangan
        </a></li>
      </ul>
    </div>
    <a onclick="loadContent('jadwal.html'); setPageTitle('Jadwal Imunisasi'); closeSidebar()">
      <i class="fas fa-calendar-alt"></i>
      <span>Jadwal Imunisasi</span>
    </a>
    <a onclick="loadContent('riwayat.html'); setPageTitle('Riwayat Imunisasi'); closeSidebar()">
      <i class="fas fa-history"></i>
      <span>Riwayat</span>
    </a>
    <a onclick="loadContent('laporan.html'); setPageTitle('ðŸ“ˆ Laporan Imunisasi Bulanan'); closeSidebar()">
      <i class="fas fa-chart-line"></i>
      <span>Laporan</span>
    </a>
    <a onclick="loadContent('pengaturan.html'); setPageTitle('Pengaturan'); closeSidebar()">
      <i class="fas fa-cog"></i>
      <span>Pengaturan</span>
    </a>
    <a href="index.html">
      <i class="fas fa-sign-out-alt"></i>
      <span>Keluar</span>
    </a>
  </nav>

  <main class="content">
    <div id="header-title" class="page-header">
      <h2 class="animated-title">Dashboard</h2>
    </div>

    <div class="content-wrapper">
      <div id="dashboard-content">
        <div class="welcome-card container-limit">
          <h2><i class="fas fa-hand-wave me-2"></i>Hai Admin!</h2>
          <p>Senang melihatmu lagi! Yuk, cek info terbaru soal imunisasi hari ini.</p>
        </div>

        <div class="container-limit">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon"><i class="fas fa-baby"></i></div>
              <div class="stat-number">150</div>
              <div class="stat-label">Bayi Diimunisasi</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
              <div class="stat-number">3</div>
              <div class="stat-label">Jadwal Hari Ini</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><i class="fas fa-syringe"></i></div>
              <div class="stat-number">1,247</div>
              <div class="stat-label">Total Imunisasi</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
              <div class="stat-number">98.5%</div>
              <div class="stat-label">Tingkat Keberhasilan</div>
            </div>
          </div>
        </div>

        <div class="card mt-4 shadow-sm container-limit">
          <div class="card-body">
            <h5 class="card-title">
              <i class="fas fa-chart-bar me-2"></i>
              Ringkasan Hari Ini
            </h5>
            <p><i class="fas fa-baby me-2"></i>Bayi yang sudah diimunisasi: <strong>150</strong></p>
            <p><i class="fas fa-clock me-2"></i>Jadwal imunisasi hari ini: <strong>3</strong></p>
          </div>
        </div>
      </div>

      <div id="dynamic-content" style="display: none;" class="container-limit"></div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function showDashboard() {
      document.getElementById('dashboard-content').style.display = 'block';
      document.getElementById('dynamic-content').style.display = 'none';
      document.getElementById('header-title').style.display = 'block';
      setPageTitle('Dashboard');
      closeSidebar();
    }

    function loadContent(url) {
      const dashboard = document.getElementById('dashboard-content');
      const container = document.getElementById('dynamic-content');
      dashboard.style.display = 'none';

      // Tutup sidebar dan overlay sebelum memuat konten baru
      closeSidebar();
      cleanupModalBackdrops();

      fetch(url)
        .then(res => {
          if (!res.ok) throw new Error(`Gagal memuat ${url}: ${res.statusText}`);
          return res.text();
        })
        .then(html => {
          container.innerHTML = html;
          container.style.display = 'block';

          // Muat script tambahan berdasarkan halaman yang dimuat
          if (url.includes('data-anak.html')) {
            loadScript('script/data-anak.js', () => {
              if (typeof loadDataAnak === 'function') loadDataAnak();
            });
          } else if (url.includes('jadwal.html')) {
            loadScript('script/jadwal.js', () => {
              if (typeof loadDataBidan === 'function') loadDataBidan();
              if (typeof loadDataJadwalKlinik === 'function') loadDataJadwalKlinik();
              if (typeof loadBidanOptions === 'function') loadBidanOptions();
              if (typeof loadDataJadwalImunisasi === 'function') loadDataJadwalImunisasi();
              cleanupModalBackdrops();
            });
          } else if (url.includes('input-perkembangan-anak.html')) {
            loadScript('script/input-perkembangan.js', () => {
              if (typeof initializePerkembanganForm === 'function') {
                initializePerkembanganForm(); // Panggil fungsi inisialisasi
              } else {
                console.error('Fungsi initializePerkembanganForm tidak ditemukan');
              }
            });
          } else if (url.includes('riwayat.html')) {
            loadScript('script/riwayat.js', () => {
              if (typeof loadDataRiwayat === 'function') loadDataRiwayat();
            });
          } else if (url.includes('laporan.html')) {
            loadScript('script/laporan.js', () => {
              if (typeof loadDataLaporan === 'function') loadDataLaporan();
              cleanupModalBackdrops();
            });
          }
        })
        .catch(error => {
          console.error('Error memuat konten:', error);
          container.innerHTML = `<div class="alert alert-danger">Gagal memuat konten: ${error.message}</div>`;
          container.style.display = 'block';
        });
    }

    // Fungsi untuk memuat script secara dinamis
    function loadScript(src, callback) {
      // Hapus script sebelumnya jika ada
      const existingScript = document.querySelector(`script[src="${src}"]`);
      if (existingScript) existingScript.remove();

      const script = document.createElement('script');
      script.src = src;
      script.async = true;
      script.onload = callback;
      script.onerror = () => console.error(`Gagal memuat script ${src}`);
      document.body.appendChild(script);
    }

    function setPageTitle(title) {
      const header = document.getElementById('header-title');
      header.style.display = 'block';
      header.innerHTML = `<h2 class="animated-title">${title}</h2>`;
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('show');
      document.getElementById('sidebarOverlay').classList.toggle('show');
    }

    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('show');
      const sidebarOverlay = document.getElementById('sidebarOverlay');
      sidebarOverlay.classList.remove('show');
      sidebarOverlay.style.display = 'none';
      sidebarOverlay.style.opacity = '0';
      console.log('Sidebar dan overlay ditutup dari dashboard');
    }

    function cleanupModalBackdrops() {
      const backdrops = document.querySelectorAll('.modal-backdrop');
      backdrops.forEach((backdrop) => {
        backdrop.remove();
        console.log('Backdrop modal dihapus dari dashboard');
      });
      document.body.classList.remove('modal-open');
      document.body.style.overflow = 'auto';
    }

    document.addEventListener('click', function(event) {
      const sidebar = document.getElementById('sidebar');
      const mobileBtn = document.querySelector('.mobile-menu-btn');
      if (window.innerWidth <= 768 && !sidebar.contains(event.target) && !mobileBtn.contains(event.target)) {
        closeSidebar();
      }
    });

    window.addEventListener('resize', function() {
      if (window.innerWidth > 768) closeSidebar();
    });

    window.onload = showDashboard;
  </script>
</body>
</html>